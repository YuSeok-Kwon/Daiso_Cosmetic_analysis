# ABSA 시스템 아키텍처 문서

---

## 1. 개요

ABSA(Aspect-Based Sentiment Analysis)는 화장품 리뷰에서 **특정 Aspect**에 대한 **Sentiment**를 추출하는 시스템입니다.

### 1.1 핵심 기능

| 기능           | 설명                                             |
| -------------- | ------------------------------------------------ |
| Aspect 추출    | 리뷰에서 언급된 10개 Aspect 식별                 |
| Sentiment 분류 | 각 Aspect별 감성(positive/neutral/negative) 판단 |
| 신뢰도 평가    | 판단의 confidence score 제공                     |
| 모호성 탐지    | 불확실한 예측 자동 플래깅                        |

---

## 2. Aspect 정의 (10개)

### 2.1 Aspect 목록

| Aspect          | 정의                    | 키워드 예시                         |
| --------------- | ----------------------- | ----------------------------------- |
| **배송/포장**   | 배송 속도, 포장 상태    | 배송, 택배, 포장, 박스, 배송중 파손 |
| **품질**        | 물리적·제조적 결함/하자 | 불량, 변질, 유통기한, 정품 여부     |
| **가격/가성비** | 가격 적정성, 가성비     | 가격, 비싸다, 저렴, 세일, 할인      |
| **사용감/성능** | 제품 사용 경험 및 효과  | 발림성, 지속력, 커버력, 보습력      |
| **용량/휴대**   | 용량 및 휴대성          | 용량, 양, 크기, 휴대성, 여행용      |
| **디자인**      | 패키징 및 외관 디자인   | 케이스, 패키지, 용기, 예쁘다        |
| **재질/냄새**   | 제품 재질감 및 향       | 냄새, 향, 텍스처, 질감, 끈적임      |
| **CS/응대**     | 고객 서비스 경험        | 교환, 환불, 문의, 응대              |
| **재구매**      | 재구매 의사 표현        | 또 살, 추천, 단골, 쟁여둠           |
| **색상/발색**   | 제품 색상 및 발색       | 색, 컬러, 톤, 발색, 쿨톤, 웜톤      |

---

## 3. 아키텍처

### 3.1 전체 데이터 흐름

```
[원본 리뷰 CSV]
      ↓
[Stratified Sampling] → 20,000건 추출
      ↓
[3단계 ChatGPT 라벨링]
      ├─ Step1: GPT-4o-mini 대량 라벨링
      ├─ Step2: GPT-4o 불확실 케이스 재판정
      └─ Step3: GPT-4o 골드셋 생성
      ↓
[라벨링 데이터 (JSONL/CSV)]
      ↓
[모델 학습] → KcELECTRA 기반 Multi-task 모델
      ↓
[추론] → 새 리뷰 분석
```

---

## 4. 샘플 데이터 구성

### 4.1 층화 샘플링 전략

원본 리뷰 데이터에서 20,000건을 추출하는 5단계 층화 샘플링 프로세스:

| 단계 | 작업                          | 설명                                         |
| ---- | ----------------------------- | -------------------------------------------- |
| 1    | 저품질 필터링                 | 중복 텍스트, 외국어(한국어 비율 < 30%) 제거  |
| 2    | 대분류(category_1) 쿼터 배정  | 비례 배분 + 최소 600건 보장                  |
| 3    | 소분류(category_2) 쿼터 배정  | 비례 배분 + 최소 200건 보장                  |
| 4    | 소분류 단위 자연 추출         | Sentiment 강제 없이 가용 범위 내 랜덤 샘플링 |
| 5    | 전체 레벨 Sentiment 균형 조정 | 목표 비율에 맞춰 부족분 추가/초과분 제거     |

### 4.2 Sentiment 목표 분포

| Sentiment | 평점 기준 | 목표 비율 |
| --------- | --------- | --------- |
| negative  | 1-2점     | 30%       |
| neutral   | 3점       | 30%       |
| positive  | 4-5점     | 40%       |

### 4.3 저품질 리뷰 필터링 기준

1. **중복 텍스트**: 동일 텍스트의 첫 번째만 유지
2. **외국어/저품질 판별**:
   - 빈 텍스트 또는 NaN
   - 한국어 비율 30% 미만
   - 자음/모음만 반복 (ㅋㅋㅋ, ㅎㅎㅎ 등)

---

## 5. 팀별 데이터 분할

### 5.1 분할 방식

20,000건 샘플 데이터를 6명의 팀원에게 균등 분배:

| 팀원  | 파일명       | 리뷰 범위         | 건수    |
| ----- | ------------ | ----------------- | ------- |
| 팀원1 | `team_1.csv` | 1 ~ 3,334번       | 3,334건 |
| 팀원2 | `team_2.csv` | 3,335 ~ 6,668번   | 3,334건 |
| 팀원3 | `team_3.csv` | 6,669 ~ 10,001번  | 3,333건 |
| 팀원4 | `team_4.csv` | 10,002 ~ 13,334번 | 3,333건 |
| 팀원5 | `team_5.csv` | 13,335 ~ 16,667번 | 3,333건 |
| 팀원6 | `team_6.csv` | 16,668 ~ 20,000번 | 3,333건 |

각 파일에는 `original_index` 컬럼이 추가되어 원본 데이터셋에서의 위치를 추적할 수 있습니다.

---

## 6. 3단계 라벨링 파이프라인

### 6.1 개요

| 단계     | 모델        | 목적                      | 예상 비용 (팀당) |
| -------- | ----------- | ------------------------- | ---------------- |
| 1단계    | GPT-4o-mini | 전체 대량 라벨링          | ~$0.80           |
| 2단계    | GPT-4o      | 불확실/충돌 케이스 재판정 | ~$1.50           |
| 3단계    | GPT-4o      | 골드셋 생성 (100건)       | ~$0.50           |
| **합계** |             |                           | **~$2.80**       |

### 6.2 Step 1: 대량 라벨링 (GPT-4o-mini)

**처리 로직:**

1. 각 리뷰에서 언급된 Aspect 추출
2. 각 Aspect별 독립적인 Sentiment 판단
3. Confidence score 산출

### 6.3 Step 2: 불확실 케이스 재판정 (GPT-4o)

**재판정 대상:**

1. 낮은 confidence (< 0.7)
2. 별점-Sentiment 충돌
   - 별점 4-5점인데 negative
   - 별점 1-2점인데 positive

**처리 로직:**

1. 대상 케이스 추출
2. GPT-4o로 재분석
3. 해당 Aspect가 없으면 삭제
4. 기존 결과 갱신

### 6.4 Step 3: 골드셋 생성 (GPT-4o)

**샘플링 전략:**

- Aspect × Sentiment 조합별 균등 샘플링
- 팀당 100건 목표
- 최소 confidence 0.7

---

## 6. Sentiment Score 체계

### 6.1 점수 범위

| 점수 | 의미      | 표현 예시                      |
| ---- | --------- | ------------------------------ |
| 1.0  | 강한 긍정 | 최고, 대박, 완벽, 인생템, 강추 |
| 0.8  | 일반 긍정 | 좋아요, 만족해요, 괜찮아요     |
| 0.0  | 중립      | 보통이에요                     |
| -0.3 | 약한 부정 | 그냥 그래요, 쏘쏘, 별로        |
| -0.7 | 일반 부정 | 실망, 아쉬워요                 |
| -1.0 | 강한 부정 | 최악, 짜증, 환불, 다시는 안 삼 |

### 6.2 계산 방식

```python
sentiment_score = P(positive) - P(negative)
# 범위: -1.0 ~ 1.0
```

---
